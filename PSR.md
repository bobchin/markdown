# PSR

[PHP-FIG](http://www.php-fig.org/) （フレームワーク・アプリケーション・ライブラリの開発者が集まったグループ）が策定した*「コーディング規約」*

## 参考

- http://www.infiniteloop.co.jp/blog/2012/10/psrphp/
- http://www.slideshare.net/yandod/psrphp
- http://9ensan.com/blog/programming/php/php-psr-coding-standards/

## 規約

- PSR-0:Autoloading Standard (オートローディング規約) ※PSR-4が推奨されるため非推奨となった
- PSR-1:Basic Coding Standard（基本コーディング規約）
- PSR-2:Coding Style Guide（コーディングスタイルガイド）
- PSR-3:Logger Interface（ロガーインタフェース）
- PSR-4:Autoloader（オートローダ）

## PSR-0

- http://www.php-fig.org/psr/psr-0/
- http://www.infiniteloop.co.jp/docs/psr/psr-0.html

以下にオートローダーの相互運用について守るべき必須条件を記述します。

*[必須条件]*
- 完全修飾された名前空間とクラスは次の構造であること。 \<ベンダー名>\(<名前空間>\)*<クラス名>

- それぞれの名前空間は、トップレベルの名前空間（ベンダー名）を持つこと。
- それぞれの名前空間は、下位にいくつでも名前空間を持つことが可能。
- それぞれの名前空間はの区切りは、ファイルシステムから読み込まれる際に**DIRECTORY_SEPARATOR** に変換される。
- *クラス名* に含まれるアンダースコア(**_**)は **DIRECTORY_SEPARATOR** に変換される。名前空間においてアンダースコアは特別な意味を持たないこと。
- 完全修飾された名前空間およびクラスは、ファイルシステムから読み込まれる際に *.php* で終了する。
- ベンダー名・名前空間・クラス名に含まれるアルファベット文字は、大文字小文字の組み合わせは自由である。


## PSR-1

- http://www.php-fig.org/psr/psr-1/
- http://www.infiniteloop.co.jp/docs/psr/psr-1-basic-coding-standard.html

このセクションの標準は、標準的なコーディング要素と考えられるもので構成されています。その要素は、共有されるPHPコード間で高レベルの技術的な相互運用を保証するために必要なものです。

 - 概要
   - ファイルは `<?php` か `<?` タグのみ使用しなければならない。
   - ファイルは PHPコード用として BOM なしの UTF-8 のみ使用しなければならない。
   - ファイルは、シンボル（クラス・関数・定数など）を宣言するか、副作用（出力を生成する・.ini 設定を変更するなど）を生じるかのどちらかであるべき。両方を同時にすべきではない。
   - 名前空間やクラスはオートローディング(PSR-0, PSR-4)に準拠しなければならない。
   - クラス名は *StudlyCaps(単語の先頭文字を大文字にする)* で宣言されなければならない。
   - クラス定数はアンダースコア区切りの大文字で宣言されなければならない。
   - メソッド名は *camelCase(単語の先頭文字を大文字にするが最初のみ小文字)* で宣言されなければならない。

- ファイル
  - PHPタグ
    PHPコードは、長いタグ `<?php ?>` か 短いechoタグ `<?= ?>` を使用しなければならない。他のタグを使用してはならない。
  - 文字コード
    PHP は BOM なしの UTF-8 のみ使用しなければならない。
  - 副作用
    ファイルは新しいシンボル（クラス・関数・定数など）を宣言し、他の副作用を生じないべきである。または副作用を伴うロジックを実行すべきである。両方を同時にすべきではない。
    **副作用** という語句はロジックの実行を意味します。クラス・関数・定数などの宣言とは直接関係しませんが、まれにファイルをインクルードことはあります。
    **副作用** 次のようなものですが、すべてではありません：
    出力の生成・`require` や `include` の使用の明示・外部サービスへの接続・設定の変更・エラーや例外の発生・グローバル変数や静的変数の変更・ファイルからの読み書きなどです。
    次に宣言と副作用の両方を持つファイルの例を挙げます。
    これは避けるべき例になります。

```PHP
<?php
// 副作用: ini 設定の変更
ini_set('error_reporting', E_ALL);

// 副作用: ファイルの読み込み
include "file.php";

// 副作用: 出力の生成
echo "<html>\n";

// 宣言
function foo()
{
    // 関数の内容
}
```

    次のサンプルは副作用をもたない宣言を含むファイルです。真似すべき例になります。

```PHP
<?php
// 宣言
function foo()
{
    // 関数の内容
}

// 副作用のない条件付きの宣言
if (! function_exists('bar')) {
    function bar()
    {
        // 関数の内容
    }
}
```

- 名前空間とクラス名
  名前空間とクラスはオートローディング(PSR-0, PSR-4)に準拠しなければなければなりません。
  これは次のことを意味します。それぞれのクラスがそれ自体が1つのファイル内にあり、少なくとも１つのレベル（トップレベルのベンダー名）の名前空間内にあります。
  クラス名は *StudlyCaps* で宣言しなければなりません。
  PHP 5.3 で記述されたコードは正式な名前空間を使用しなければなりません。

```PHP
<?php
// PHP 5.3 以降:
namespace Vendor\Model;

class Foo
{
}
```

PHP 5.2 以前で記述されたコードは、クラス名に *Vendor_* プレフィックスを使用した仮の名前空間の慣習を使用しなければなりません。

```PHP
?php
// PHP 5.2.x 以前:
class Vendor_Model_Foo
{
}
```

- クラス定数・プロパティ・メソッド
  *クラス* という用語は、クラス・インターフェース・トレイト全てのことを指します。
  
  - 定数
    クラス定数はすべてアンダースコア区切りをもつ大文字で宣言されなければならない。

```PHP
<?php
namesapce Vendor\Model;

class Foo
{
    const VERSION = '1.0';
    const DATE_APPROVED = '2012-06-01';
}
```

  - プロパティ
    このガイドでは、`$StudlyCaps` や `$camelCase` や `$under_score` などのプロパティ名を使用することの推奨は意図的に避けています。
    命名についての慣習を使用するときは、妥当なスコープ内で一貫性をもたせるべきです。そのスコープはベンダーレベル・パッケージレベル・クラスレベル・メソッドレベルなど様々です。

  - メソッド
    メソッドは `camelCase()` で宣言されなければならない。


## PSR-2

- http://www.php-fig.org/psr/psr-2/
- http://www.infiniteloop.co.jp/docs/psr/psr-2-coding-style-guide.html

  コーディングスタイルガイド
  
  このガイドは PSR-1（基本コーディング標準）の延長であり拡張です。
  このガイドの目的は、異なる著者がコードを読む際の認識のズレを減らすことです。そのために、PHPコードの書式をどうすべきかについて共有されるべきルールや期待を列挙します。
  ここにおいてスタイルルールは、様々なプロジェクト内の共通点から導かれています。さまざまな著者が複数のプロジェクトに渡って共同作業する際に、全てのプロジェクトで使用される一連のガイドラインがあると役立ちます。このように、このガイドの恩恵はルールそれ自体にあるわけではなく、ルールを共有することにあります。
  このドキュメント内のキーワード *MUST* *MUST NOT* *REQUIRED* *SHALL* *SHALL NOT* *SHOULD* *SHOULD NOT* *RECOMMENDED* *MAY* *OPTIONAL* は**RFC 2119** で記述されているもので解釈してください。
  
### 概要
  - コードは、"コーディングスタイルガイド" PSR-1 に準拠しなければならない。
  - コードは、インデントにスペース4つを使用し、タブを使用してはならない。
  - 1行の長さにハードリミットがあってはならない。ソフトリミットは120文字でなければならない。1行は80文字以内にすべきです。
  - *名前空間* の宣言の後に空白行を1行置かなければならない。*use* 宣言のブロックの後にも空白行を1行置かなければならない。
  - クラスの開き波カッコは次の行に記述しなければならない。閉じ波カッコは本文最後の次の行に記述しなければならない。
  - メソッドの開き波カッコは次の行に記述しなければならない。閉じ波カッコは本文最後の次の行に記述しなければならない。
  - すべてのプロパティとメソッドにアクセス修飾子を宣言しなければならない。*abstract* や *final* はアクセス修飾子の前に宣言しなければならない。*static* はアクセス修飾子の後に宣言しなければならない。
  - 制御構造のキーワードは、その直後にスペース１つを開けなければならない。メソッドや関数の呼び出しはスペースを開けてはならない。
  - 制御構造の開き波カッコは同じ行に置かなければならない。閉じ波カッコは本文最後の次の行に置かなければならない。
  - 制御構造の開き丸カッコは、その直後にスペースを開けてはならない。閉じ丸カッコも前にスペースを開けてはならない。

#### 例
  この例はクリックプレビューとして以下のルールを含んでいます。

```PHP
<?php
namespace Vendor\Package;
                                                    // 名前空間の後は空行１つ
use FooInterface;
use BarClass as Bar;
use OtherVendor\OtherPackage\BazClass;
                                                    // useの塊の後は空行１つ
class Foo extends Bar implements FooInterface
{                                                   // クラス開きカッコは次行
    public function sampleFunction($a, $b = null)   // インデントはスペース４つ
    {                                               // メソッドの開きカッコは次行
        if ($a === $b) {                            // 制御構造
            bar();                                  // メソッド呼び出し
        } elseif ($a > $b) {
            $foo->bar($arg1);
        } else {
            BazClass::bar($arg2, $arg3);
        }
    }                                               // メソッドの閉じカッコ

    final public static function bar()              // 修飾子の順序
    {
        // method body
    }
}                                                  // クラス閉じカッコ
```

### 概要

#### 基本コーディング標準
コードは *PSR-1* に準拠しなければならない。

#### ファイル
すべての PHP ファイルは UNIX LF（ラインフィード）形式の改行を使用しなければならない。
すべての PHP ファイルは１つの空行で終了しなければならない。
閉じ `?>` タグは PHP のみ含んでいるファイルの場合は省略しなければならない。

#### 行
１行の長さにハードリミットがあってはならない。
１行のソフトリミットは120文字でなければならない。自動化された書式チェッカーは警告しなければならないが、ソフトリミットでエラーとしてはならない。
行は80文字以上にすべきではありません。80文字以上の行はそれぞれ80文字以内の複数の行に分割すべきです。
スペースのない行の末尾にスペースをいれてはならない。
可読性向上のためまたはコードのかたまりを明示するために空行が追加される可能性があります。
1行に複数のステートメント（文）があってはならない。

#### インデント
コードはスペース4つを使用しなければならない。インデントにタブを使用してはならない。

> 注意: スペースとタブを混在せずにスペースのみを使用することで、diff・patches・histroy・annotations の使用時にトラブルを避けることができます。また、スペースを使用することで内部の行合わせのためにきめ細かなサブインデントを挿入しやすくなります。

#### キーワードと True/False/null
PHP 予約語は小文字でなければならない。PHP 定数の true, false, null は小文字でなければならない。


### 名前空間と use 宣言
`名前空間` 宣言の後に空行を1つ入れなければならない。
すべての `use` 宣言は `名前空間` 宣言の後になければならない。
1つの宣言につき１つの `use` を使用しなければならない。
`use` ブロックの後に空行を1つ入れなければならない。

例:

```PHP
<?php
namespace Vendor\Package;

use FooClass;
use BarClass as Bar;
use OtherVendor\OtherPackage\BazClass;

// ... PHP コード ...
```

### クラス・プロパティ・メソッド
*クラス* という用語は、クラス・インターフェース・トレイト全てのことを指します。

#### Extends と Implements
`extends` と `implements` キーワードはクラス名と同じ行に宣言しなければならない。
クラスの開きカッコは、次の行になければならない。クラスの閉じカッコは本文最後の次の行になければならない。

```PHP
<?php
namespace Vendor\Package;

use FooClass;
use BarClass as Bar;
use OtherVendor\OtherPackage\BazClass;

class ClassName extends ParentClass implements \ArrayAccess, \Countable
{
    // constants, properties, methods
}
```

`implements` のリストは、複数行に分割される可能性があります。それぞれの後続行は1段インデントします。そのようにした場合、リストの最初の項目は次の行になければならない。また、1行につき1つのインターフェースにしなければならない。

```PHP
<?php
namespace Vendor\Package;

use FooClass;
use BarClass as Bar;
use OtherVendor\OtherPackage\BazClass;

class ClassName extends ParentClass implements
    \ArrayAccess,
    \Countable,
    \Serializable
{
    // constants, properties, methods
}
```

#### プロパティ
アクセス修飾子はすべてのプロパティに対して宣言しなければならない。
`var` キーワードはプロパティを宣言するために使用してはならない。
1つの文につき複数のプロパティを宣言してはならい。
プロパティ名は、1つのアンダースコアを先頭につけて protected や private を示すべきではない。
プロパティ宣言は次ようになります。

```PHP
<?php
namespace Vendor\Package;

class ClassName
{
    public $foo = null;
}
```

#### メソッド
アクセス修飾子はすべてのメソッドに対して宣言しなければならない。
メソッド名は、1つのアンダースコアを先頭につけて protected や private を示すべきではない。
メソッド名はメソッド名の後にスペースを入れてはならない。開き波カッコは次の行にしなければならない。閉じ波カッコは本文最後の次の行にしなければならない。開き丸カッコの後にスペースをいれてはならない。閉じ丸括弧前にスペースをいれてはならない。
メソッド宣言は次のようになります。丸カッコ・カンマ・スペース・波カッコの位置に注意してください。

```PHP
<?php
namespace Vendor\Package;

class ClassName
{
    public function fooBarBaz($arg1, &$arg2, $arg3 = [])
    {
        // method body
    }
}
```

#### メソッド引数
引数のリストについて、それぞれのカンマの前にスペースをいれてないならない。それぞれのカンマの後にはスペースを1ついれなければならない。
デフォルト値をもつメソッド引数は、引数リストの最後に配置しなければならない。

```PHP
<?php
namespace Vendor\Package;

class ClassName
{
    public function foo($arg1, &$arg2, $arg3 = [])
    {
        // method body
    }
}
```

引数リストは複数行に分割される可能性があります。それぞれの後続行は1段インデントします。そのようにした場合、リストの最初の項目は次の行になければならない。また、1行につき1つの引数にしなければならない。
引数リストは複数行に分割される可能性があるため、閉じ丸カッコと開き波カッコは、間に1つのスペースをいれて同じ行に置かなければならない。

```PHP
<?php
namespace Vendor\Package;

class ClassName
{
    public function aVeryLongMethodName(
        ClassTypeHint $arg1,
        &$arg2,
        array $arg3 = []
    ) {
        // method body
    }
```

#### `abstract`, `final`, `static`
`abstract` と `final` 宣言はアクセス修飾子宣言の前になければならない。
`static` 宣言はアクセス修飾子宣言の後になければならない。
}

```PHP
<?php
namespace Vendor\Package;

abstract class ClassName
{
    protected static $foo;

    abstract protected function zim();

    final public static function bar()
    {
        // method body
    }
}
```

#### メソッドと関数呼び出し
メソッドや関数を呼び出す際に、メソッドや関数名と開き丸カッコの間にスペースをいれてはならない。開き丸カッコの後にスペースをいれてはならない。閉じ丸カッコの前にスペースをいれてはならない。引数リスト内で、それぞれのカンマの前にスペースをいれてはならない。また、それぞれのカンマの後にはスペースを１つ入れなければならない。

```PHP
<?php
bar();
$foo->bar($arg1);
Foo::bar($arg2, $arg3);
```

引数リストは複数行に分割される可能性があります。それぞれの後続行は1段インデントします。そのようにした場合、リストの最初の項目は次の行になければならない。また、1行につき1つの引数にしなければならない。

```PHP
<?php
$foo->bar(
    $longArgument,
    $longerArgument,
    $muchLongerArgument
);
```

### 制御構造
制御構造についての一般的なスタイルルールは次のようになります：

- 制御構造キーワードの後にスペースを１ついれなければならない
- 開き丸カッコの後にスペースをいれてはならない。
- 閉じ丸カッコの前にスペースをいれてはならない。
- 閉じ丸カッコと開き波カッコの間にスペースを１ついれなければならない。
- 構文本体は１段インデントを下げなければならない。
- 閉じ波カッコは本文最後の次の行に置かなければならない。

それぞれの構文の本文は波括弧で囲まなければならない。これは構文の見た目を標準化し、本文に新しい行が追加されたときにエラーを招く可能性を下げます。

#### `if`, `elseif`, `else`
`if` 構文は次のようになります。丸カッコ・スペース・波カッコの位置に注意してください。また、`else` や `elseif` は閉じ波カッコと同じ行におきます。









## PSR-4

- http://www.php-fig.org/psr/psr-4/

### オートローダー
このドキュメント内のキーワード *MUST* *MUST NOT* *REQUIRED* *SHALL* *SHALL NOT* *SHOULD* *SHOULD NOT* *RECOMMENDED* *MAY* *OPTIONAL* は**RFC 2119** で記述されているもので解釈してください。

#### 概要
この PSR はファイル検索パスからクラスをオートロードするための仕様を記述します。これは完全に相互運用可能で、PSR-0 を含めた他のオートロードに関する仕様に加えて使用することができます。この PSR は仕様にしたがってオートロードされるためにファイルをどこに置くべきかについても記述しています。

#### 仕様

1. **クラス** という用語は、クラス・インターフェース・トレイトおよびその他の似たような構造を示します。

1. 完全修飾クラス名は次のような形式をもちます:

`\<NamespaceName>(\<SubNamespaceNames>)*\<ClassName>`

  1. 完全修飾クラス名は、トップレベル名前空間名を持たなければならない。これは**ベンダー名前空間**とされています。
  1. 完全修飾クラス名は、1つ以上の下位の名前空間名を持ってもよい。
  1. 完全修飾クラス名は、クラス名で終了していなければならない。
  1. アンダースコアは、完全修飾クラス名においては特別な意味を持たない。
  1. 完全修飾クラス名内のアルファベット文字は、大文字小文字が混在してもよい。
  1. 全てのクラス名は、大文字と小文字を区別しなければならない。

1. 完全修飾クラス名に該当するファイルを読み込む場合

  1. 完全修飾クラス名（"名前空間プレフィックス"）において、先頭の名前空間区切り文字を除外した、1つ以上の先頭の名前空間と下位名前空間に隣接する1連の語句は、少なくとも1つの **"基本ディレクトリ"** に対応します。
  1. "名前空間プレフィックス" の後に隣接した下位名前空間は、 **"基本ディレクトリ"** 内のサブディレクトリに対応します。名前空間区切り文字はディレクトリ区切り文字を表します。サブディレクトリ名は下位名前空間と合致しなければなりません。
  1. クラス名の最後は、`.php` で終わるファイル名と対応します。ファイル名はクラス名の最後と一致します。
  1. オートローダ-の実装は例外を送出してはならない。また、いかなるレベルのエラーも発生してはならいし、値を返すべきではない。

#### 例
以下の表は、与えられた完全修飾クラス名・名前空間プレフィックス・基本ディレクトリのファイルパスを表しています。


| 完全修飾クラス名             | 名前空間プレフィックス | 基本ディレクトリ       | ファイルパスの結果                                    |
| :--------------------------: | :--------------------: | :--------------------: | :---------------------------------------: |
| \Acme\Log\Writer\File_Writer | Acme\Log\Writer	      | ./acme-log-writer/lib/ | ./acme-log-writer/lib/File_Writer.php     |
| \Aura\Web\Response\Status    | Aura\Web               | /path/to/aura-web/src/ | /path/to/aura-web/src/Response/Status.php |
| \Symfony\Core\Request        | Symfony\Core           | ./vendor/Symfony/Core/ | ./vendor/Symfony/Core/Request.php         |
| \Zend\Acl                    | Zend                   | /usr/includes/Zend/    | /usr/includes/Zend/Acl.php                |

この仕様に準じたオートローダの実装例として、サンプルファイルを見てください。実装例は仕様の一部と考えてはいけません。変更される可能性があります。








あ
