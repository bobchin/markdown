# ネットワーク

## パケット

- OSI参照モデル
  - アプリケーション層(L7)
  - プレゼンテーション層(L6)
  - セッション層(L5)
  - トランスポート層(L4)
  - ネットワーク層(L3)
  - データリンク層(L2)
  - 物理層(L1)

- TCP/IPモデル
  - アプリケーション層(L5+L6+L7)
  - トランスポート層(L4)
  - インターネット層(L3)
  - ネットワークインタフェース層(L1+L2)

- プロトコル階層
  - ネットワークインタフェース層
    - EthernetⅡ
  - インターネット層
    - ARP, IP
  - トランスポート層
    - TCP, UDP
  - アプリケーション層
    - HTTP, DNS, SSL, ....

- ヘッダ
  - EthernetⅡ
    - プリアンブル（同期をとるための開始信号。64ビット=8バイト）
      - 16進で"AA-AA-AA-AA-AA-AA-AA-AB" => "10101010-10101010-.....-10101011"
      - "10"が62ビット＋最後2ビットに"11"
    - 最小64バイト（プリアンブルは除く）
      - 6 + 6 + 2 + 46 + 4 = 64
    - ヘッダ
      - 6 + 6 + 2 = 14（バイト）
      - 宛先MACアドレス（48ビット=6バイト）
      - 送信元MACアドレス（48ビット=6バイト）
        - ※MACアドレスの7ビット目（LG bit MACアドレスが付け替えられているかどうか。1の場合変更されている）
        - ※MACアドレスの8ビット目（IG bit ブロードキャストorマルチキャストかどうか。1の場合キャストされている）
      - イーサタイプ（次のパケットのプロトコルが何か。16ビット=2バイト）　※IANAで決めている
        - 0x0800: IPV4
        - 0x86dd: IPV6
        - 0x0806: ARP
    - データ（46～1500バイト）
    - FCS（フレームチェックシーケンス。フレームの誤り検出。32ビット=4バイト）
      - フレームのチェックサムが入る

  - ARP(IPから宛先のMACアドレスを問い合わせる)
    - ハードウェアタイプ（データリンク層のプロトコル。16ビット=2バイト）
      - EthernetⅡ: 0x0001
    - プロトコロタイプ（ネットワーク層のプロトコル。16ビット=2バイト）
      - ARPはIP => IPV4: 0x 0800
    - ハードウェアサイズ（MACアドレスの長さ。8ビット=1バイト）
      - MACアドレスのサイズ: 6(0x06)
    - プロトコロサイズ（ネットワーク層のプロトコルの長さ。8ビット=1バイト）
      - ARPはIP: 4(0x04)
    - オペレーションビット（ARPの種類を指定。16ビット=2バイト）
      - ARPリクエスト: 1(0x0001)
      - ARPリプライ　: 2(0x0002)
    - 送信元ハードウェアアドレス（送信元MACアドレス。48ビット=6バイト）
    - 送信元プロトコルアドレス（送信元IP。32ビット=4バイト）
    - 相手先ハードウェアアドレス（相手先MACアドレス。48ビット=6バイト）
      - ARPリクエストの場合相手先がわからないので、"00 00 00 00 00 00"
    - 相手先プロトコルアドレス（相手先IP。32ビット=4バイト）

  - IP
    - ヘッダ
      - 0.5 + 0.5 + 1 + 2 + 2 + 2(3+13) + 1 + 1 + 2 + 4 + 4 = 20
    - バージョン（4ビット=0.5バイト）
      - IPV4: 0x4
    - ヘッダ長（4ビット=0.5バイト）
      - 20バイト: 0x5 => 5x4バイト（32ビット）= 20バイト（160ビット）
    - TOS（QoSで使用する。8ビット=1バイト）
      - 2種類の用途
        - TOS(Type Of service)
          - 上位3ビットで優先順位をつける
        - DSF(Differentiated Services Field)
          - 上位6ビットで優先順位をつける => DSCP(DiffServ Code Point)
          - 上位3ビットで優先度＋残り3ビットでパケットの破棄の割合を指定
    - IPパケット全体のサイズ（16ビット=2バイト）
      - IPパケットの長さ => IPはEthernetⅡ上だけで使用されるとは限らないのでMTUが変わる可能性があるため。
        このサイズからIPヘッダ長を引くことでIPペイロードの大きさがわかる。
    - パケット識別子（16ビット=2バイト）
      - パケットを区別するための番号
    - フラグ（3ビット）
      - フラグメントの設定
      - 1バイト目:予約
      - 2バイト目:DF(Don't Flag) => パケットを分割させない
      - 3バイト目:MF(More Flag)  => 分割されたパケットがまだ続く
    - フラグメントオフセット（13ビット）
      - 運んでいるデータがどの位置のデータかをバイト数で指定
    - TTL（8ビット=1バイト）
      - ルータを何個超えられるかを指定
    - プロトコル（8ビット=1バイト）
      - データのプロトコル
      -  1: ICMP
      -  6: TCP
      - 17: UDP
    - ヘッダチェックサム（16ビット=2バイト）
      - ヘッダのチェックサム
    - 送信元IP（32ビット=4バイト）
    - 相手先IP（32ビット=4バイト）
    - オプション（任意）
    - パディング（任意）

## IPアドレス

- アドレスクラス
  - クラスA：0で始まり上位８ビットまで
    ネットワークアドレスは "0xxxxxxxx"
    [00000000]～[01111111] => 0.x.x.x～127.x.x.x
    - 特定用途: 0.x.x.x と 127.x.x.x

  - クラスB：10で始まり上位16ビットまで
    ネットワークアドレスは "10xxxxxxx.xxxxxxxx"
    [10000000.00000000]～[10111111.11111111] => 128.0.x.x～191.255.x.x
    - 特定用途: 128.0.x.x と 191.255.x.x

  - クラスC：110で始まり上位24ビットまで
    ネットワークアドレスは "110xxxxxx.xxxxxxxx.xxxxxxxx"
    [11000000.00000000.00000000]～[11011111.11111111.11111111] => 192.0.0.x～223.255.255.x
    - 特定用途: 192.0.0.x と 223.255.255.x

  - クラスD(IPマルチキャスト)：1110で始まり上位32ビットまで
    ネットワークアドレスは "1110xxxxx.xxxxxxxx.xxxxxxxx.xxxxxxxx"
    [11100000.00000000.00000000.00000000]～[11101111.11111111.11111111] => 224.0.0.0～239.255.255.x

- サブネット

|プレフィックス| 25 | 26 | 27 | 28 | 29 | 30 | 31 |
|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|
|値| 128 | 192 | 224 | 240 | 248 | 252 | 254 |
|値| 128 | 128+64 | 128+64+32 | 128+64+32+16 | 128+64+32+16+8 | 128+64+32+16+8+4 | 128+64+32+16+8+4+2 |
|ビット| 10000000 | 11000000 | 11100000 | 11110000 | 11111000 | 11111100 | 11111110 |

- プライベートアドレス
  - 10.0.0.0/8    (10.0.0.0～10.255.255.255)
  - 172.16.0.0./12(172.16.0.0～172.31.255.255)
  - 192.168.0.0/16(192.168.0.0～192.168.255.255)

